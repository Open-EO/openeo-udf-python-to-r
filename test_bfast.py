from udf_lib import execute_udf, create_dummy_cube
import time

# Data Cube config
dims = ['x', 'y', 't', 'b']
sizes = [10, 10, 500, 3]
labels = {
    # x and y get generated automatically for now (todo: get from actual data)
    'x': None,
    'y': None,
    't': ["2021-01-01T16:51:15Z","2021-01-02T09:08:14Z","2021-01-02T10:59:02Z","2021-01-02T14:45:59Z","2021-01-03T05:29:46Z","2021-01-03T23:39:45Z","2021-01-07T05:56:52Z","2021-01-07T06:08:24Z","2021-01-07T09:46:41Z","2021-01-08T03:20:54Z","2021-01-09T20:19:51Z","2021-01-10T07:41:23Z","2021-01-10T14:07:32Z","2021-01-10T22:45:22Z","2021-01-11T07:23:45Z","2021-01-11T14:14:10Z","2021-01-12T05:19:17Z","2021-01-14T14:09:04Z","2021-01-14T15:12:03Z","2021-01-14T22:39:45Z","2021-01-16T07:34:08Z","2021-01-18T07:23:13Z","2021-01-18T08:40:02Z","2021-01-18T22:18:03Z","2021-01-21T03:10:01Z","2021-01-21T08:06:49Z","2021-01-21T23:55:40Z","2021-01-23T06:39:20Z","2021-01-23T08:00:53Z","2021-01-25T15:45:35Z","2021-01-26T00:53:27Z","2021-01-26T02:32:40Z","2021-01-26T06:02:54Z","2021-01-28T23:31:31Z","2021-01-29T17:50:01Z","2021-01-30T00:36:53Z","2021-01-30T05:40:04Z","2021-01-30T17:04:14Z","2021-01-30T18:21:29Z","2021-01-31T00:36:21Z","2021-02-01T13:28:48Z","2021-02-03T02:10:41Z","2021-02-04T03:42:07Z","2021-02-07T03:11:06Z","2021-02-09T02:04:06Z","2021-02-09T05:50:54Z","2021-02-09T12:22:53Z","2021-02-09T19:41:37Z","2021-02-10T19:51:59Z","2021-02-11T00:52:30Z","2021-02-11T03:01:33Z","2021-02-11T17:13:37Z","2021-02-11T19:32:16Z","2021-02-11T23:10:29Z","2021-02-12T02:30:31Z","2021-02-12T14:29:54Z","2021-02-12T20:42:12Z","2021-02-14T13:09:52Z","2021-02-14T19:46:09Z","2021-02-14T21:11:31Z","2021-02-15T02:57:09Z","2021-02-17T03:26:18Z","2021-02-17T21:29:28Z","2021-02-18T02:33:16Z","2021-02-19T14:34:53Z","2021-02-20T01:44:35Z","2021-02-22T04:25:58Z","2021-02-24T11:48:28Z","2021-02-24T11:58:44Z","2021-02-24T17:40:43Z","2021-02-26T08:31:18Z","2021-02-27T01:50:40Z","2021-02-27T08:33:36Z","2021-02-28T22:34:12Z","2021-03-01T10:59:00Z","2021-03-01T21:43:22Z","2021-03-02T01:27:15Z","2021-03-03T07:41:44Z","2021-03-04T00:54:10Z","2021-03-04T02:31:59Z","2021-03-04T04:48:55Z","2021-03-04T14:07:57Z","2021-03-08T13:42:16Z","2021-03-08T18:59:57Z","2021-03-09T14:56:28Z","2021-03-10T21:17:18Z","2021-03-11T04:25:23Z","2021-03-11T20:03:03Z","2021-03-12T15:21:17Z","2021-03-14T06:04:35Z","2021-03-14T08:09:45Z","2021-03-15T08:55:39Z","2021-03-15T13:35:41Z","2021-03-15T14:16:05Z","2021-03-15T22:39:28Z","2021-03-16T06:20:12Z","2021-03-16T19:14:13Z","2021-03-17T14:57:08Z","2021-03-17T21:56:01Z","2021-03-18T12:01:25Z","2021-03-19T06:11:36Z","2021-03-19T07:28:31Z","2021-03-19T09:44:47Z","2021-03-19T11:42:46Z","2021-03-19T16:52:41Z","2021-03-19T19:24:00Z","2021-03-20T23:21:00Z","2021-03-21T10:47:26Z","2021-03-22T08:58:38Z","2021-03-22T09:08:57Z","2021-03-23T10:45:27Z","2021-03-25T11:17:10Z","2021-03-26T13:21:12Z","2021-03-28T01:43:49Z","2021-03-28T04:54:49Z","2021-03-28T23:13:12Z","2021-03-29T11:47:46Z","2021-03-29T13:42:52Z","2021-03-30T16:42:34Z","2021-03-31T15:26:45Z","2021-03-31T18:25:49Z","2021-04-01T11:50:40Z","2021-04-01T23:01:56Z","2021-04-02T10:07:58Z","2021-04-03T09:29:15Z","2021-04-03T17:21:29Z","2021-04-05T09:16:12Z","2021-04-06T05:38:35Z","2021-04-07T10:31:30Z","2021-04-07T23:13:42Z","2021-04-08T02:37:27Z","2021-04-08T05:01:42Z","2021-04-08T23:36:41Z","2021-04-09T03:09:38Z","2021-04-09T03:44:08Z","2021-04-09T09:10:25Z","2021-04-09T19:51:50Z","2021-04-11T09:10:49Z","2021-04-11T19:19:22Z","2021-04-12T10:25:31Z","2021-04-12T10:50:56Z","2021-04-12T15:01:32Z","2021-04-13T05:17:24Z","2021-04-13T20:59:27Z","2021-04-15T13:27:36Z","2021-04-16T01:01:31Z","2021-04-16T21:22:03Z","2021-04-17T02:18:49Z","2021-04-17T18:57:26Z","2021-04-17T20:03:18Z","2021-04-17T23:23:05Z","2021-04-19T12:16:26Z","2021-04-19T20:11:04Z","2021-04-19T22:38:57Z","2021-04-20T05:21:59Z","2021-04-20T22:21:03Z","2021-04-21T00:30:13Z","2021-04-21T23:06:49Z","2021-04-23T13:25:25Z","2021-04-24T03:11:11Z","2021-04-24T06:52:47Z","2021-04-24T14:57:33Z","2021-04-24T16:42:11Z","2021-04-25T23:48:39Z","2021-04-27T07:21:18Z","2021-04-27T17:20:12Z","2021-04-29T00:45:03Z","2021-04-29T22:49:46Z","2021-04-30T20:46:32Z","2021-05-01T20:43:49Z","2021-05-02T01:09:59Z","2021-05-02T05:09:06Z","2021-05-02T12:49:13Z","2021-05-02T14:19:31Z","2021-05-03T23:35:01Z","2021-05-04T02:48:38Z","2021-05-05T06:54:48Z","2021-05-06T09:34:08Z","2021-05-07T06:25:10Z","2021-05-07T22:59:08Z","2021-05-08T17:13:59Z","2021-05-08T20:30:45Z","2021-05-09T01:55:21Z","2021-05-10T03:49:02Z","2021-05-10T05:33:58Z","2021-05-10T06:24:15Z","2021-05-11T15:56:21Z","2021-05-12T00:50:26Z","2021-05-13T00:21:57Z","2021-05-13T09:03:39Z","2021-05-13T09:30:51Z","2021-05-14T00:59:50Z","2021-05-14T12:44:27Z","2021-05-14T13:17:55Z","2021-05-15T07:23:44Z","2021-05-15T08:13:11Z","2021-05-15T17:06:23Z","2021-05-17T15:30:47Z","2021-05-18T16:51:41Z","2021-05-22T00:27:41Z","2021-05-23T06:28:40Z","2021-05-23T16:50:03Z","2021-05-24T07:28:13Z","2021-05-26T16:51:54Z","2021-05-26T23:48:48Z","2021-05-27T15:03:34Z","2021-05-27T17:12:40Z","2021-05-29T01:45:44Z","2021-05-30T12:35:39Z","2021-05-31T09:16:11Z","2021-06-04T13:14:59Z","2021-06-04T13:38:46Z","2021-06-05T12:31:04Z","2021-06-05T19:08:08Z","2021-06-06T07:25:23Z","2021-06-06T08:38:58Z","2021-06-07T13:47:33Z","2021-06-07T19:18:15Z","2021-06-08T00:23:21Z","2021-06-08T01:51:39Z","2021-06-08T04:29:05Z","2021-06-08T08:52:19Z","2021-06-10T00:29:08Z","2021-06-11T14:52:07Z","2021-06-11T20:01:03Z","2021-06-12T20:04:55Z","2021-06-13T07:27:28Z","2021-06-13T11:41:59Z","2021-06-13T21:57:55Z","2021-06-15T15:46:39Z","2021-06-16T06:56:30Z","2021-06-17T16:04:12Z","2021-06-17T20:47:10Z","2021-06-18T15:51:54Z","2021-06-21T02:24:46Z","2021-06-21T09:56:55Z","2021-06-21T11:43:05Z","2021-06-21T13:43:19Z","2021-06-21T16:43:50Z","2021-06-23T07:09:38Z","2021-06-23T23:11:09Z","2021-06-24T21:08:57Z","2021-06-24T22:56:12Z","2021-06-26T02:04:09Z","2021-06-26T03:34:11Z","2021-06-26T18:47:25Z","2021-06-26T21:20:50Z","2021-06-27T05:03:37Z","2021-06-28T05:41:14Z","2021-06-28T15:29:30Z","2021-06-30T16:56:39Z","2021-07-01T22:23:42Z","2021-07-02T11:48:11Z","2021-07-02T20:38:13Z","2021-07-04T14:58:07Z","2021-07-05T04:58:32Z","2021-07-06T16:35:36Z","2021-07-07T17:33:52Z","2021-07-07T20:29:24Z","2021-07-11T02:26:16Z","2021-07-11T06:46:01Z","2021-07-12T01:21:52Z","2021-07-13T10:23:54Z","2021-07-13T18:56:37Z","2021-07-13T20:23:19Z","2021-07-14T13:16:31Z","2021-07-15T17:38:25Z","2021-07-18T00:54:32Z","2021-07-18T06:14:23Z","2021-07-18T11:24:32Z","2021-07-18T16:08:01Z","2021-07-18T21:17:53Z","2021-07-19T09:51:48Z","2021-07-19T13:34:44Z","2021-07-19T21:18:39Z","2021-07-20T04:01:47Z","2021-07-21T22:51:23Z","2021-07-22T03:31:48Z","2021-07-22T10:07:33Z","2021-07-23T06:55:07Z","2021-07-23T20:35:04Z","2021-07-25T02:00:00Z","2021-07-25T16:23:58Z","2021-07-25T23:06:22Z","2021-07-28T00:58:05Z","2021-07-28T01:45:39Z","2021-07-28T12:00:34Z","2021-07-29T07:26:57Z","2021-07-29T07:37:48Z","2021-07-29T23:17:53Z","2021-07-30T07:07:22Z","2021-07-30T14:09:43Z","2021-07-30T16:34:57Z","2021-07-30T22:41:38Z","2021-07-31T12:36:49Z","2021-08-01T03:57:27Z","2021-08-01T20:03:16Z","2021-08-01T21:22:25Z","2021-08-03T05:15:18Z","2021-08-03T23:57:00Z","2021-08-04T14:16:07Z","2021-08-04T23:44:49Z","2021-08-07T14:13:48Z","2021-08-07T18:15:05Z","2021-08-08T23:02:11Z","2021-08-09T20:04:11Z","2021-08-10T07:31:40Z","2021-08-10T13:56:44Z","2021-08-11T20:22:26Z","2021-08-13T16:50:04Z","2021-08-14T04:08:13Z","2021-08-15T00:25:27Z","2021-08-15T00:33:46Z","2021-08-15T03:05:04Z","2021-08-15T13:11:51Z","2021-08-17T04:49:37Z","2021-08-17T07:44:12Z","2021-08-18T18:17:38Z","2021-08-18T21:43:41Z","2021-08-19T08:26:33Z","2021-08-20T08:08:32Z","2021-08-21T20:52:55Z","2021-08-22T13:12:17Z","2021-08-22T13:15:16Z","2021-08-23T00:44:22Z","2021-08-23T00:58:27Z","2021-08-23T12:27:46Z","2021-08-23T15:46:50Z","2021-08-23T16:05:02Z","2021-08-24T02:31:01Z","2021-08-24T09:30:04Z","2021-08-25T00:18:43Z","2021-08-25T17:34:46Z","2021-08-25T22:33:52Z","2021-08-25T23:47:22Z","2021-08-26T03:59:31Z","2021-08-26T07:14:48Z","2021-08-26T11:48:13Z","2021-08-27T19:48:01Z","2021-08-28T15:34:44Z","2021-08-29T14:25:41Z","2021-08-30T16:43:07Z","2021-08-31T02:50:42Z","2021-08-31T07:17:45Z","2021-08-31T17:25:03Z","2021-09-04T03:49:53Z","2021-09-04T21:43:56Z","2021-09-05T02:45:18Z","2021-09-06T01:34:15Z","2021-09-07T12:11:41Z","2021-09-08T00:41:07Z","2021-09-08T04:10:49Z","2021-09-08T14:21:05Z","2021-09-08T15:17:52Z","2021-09-08T19:52:55Z","2021-09-09T00:19:30Z","2021-09-09T00:41:12Z","2021-09-09T16:36:38Z","2021-09-09T23:28:05Z","2021-09-13T15:18:22Z","2021-09-13T19:22:39Z","2021-09-15T04:52:26Z","2021-09-15T22:42:15Z","2021-09-17T01:44:08Z","2021-09-17T06:19:14Z","2021-09-17T10:04:25Z","2021-09-17T21:13:54Z","2021-09-18T01:00:20Z","2021-09-18T01:12:35Z","2021-09-19T08:31:36Z","2021-09-20T12:52:04Z","2021-09-21T01:58:27Z","2021-09-21T21:02:05Z","2021-09-22T17:18:03Z","2021-09-22T22:28:45Z","2021-09-23T01:05:58Z","2021-09-29T08:47:48Z","2021-09-29T16:55:20Z","2021-09-30T13:06:03Z","2021-10-01T11:47:16Z","2021-10-02T16:48:36Z","2021-10-02T19:41:00Z","2021-10-03T10:48:43Z","2021-10-04T21:52:10Z","2021-10-05T23:40:16Z","2021-10-06T02:33:21Z","2021-10-06T08:26:21Z","2021-10-06T14:44:00Z","2021-10-06T16:10:59Z","2021-10-07T18:44:14Z","2021-10-07T22:05:54Z","2021-10-08T00:34:06Z","2021-10-08T02:16:14Z","2021-10-09T20:25:03Z","2021-10-10T10:18:27Z","2021-10-13T18:52:17Z","2021-10-15T21:40:28Z","2021-10-16T10:35:25Z","2021-10-16T22:32:23Z","2021-10-17T08:11:28Z","2021-10-17T10:30:27Z","2021-10-18T00:42:04Z","2021-10-20T04:57:42Z","2021-10-20T06:04:18Z","2021-10-20T10:51:24Z","2021-10-20T15:10:08Z","2021-10-21T00:28:15Z","2021-10-21T05:24:26Z","2021-10-21T14:50:47Z","2021-10-22T08:03:15Z","2021-10-23T09:05:00Z","2021-10-24T21:24:08Z","2021-10-25T13:10:43Z","2021-10-27T16:57:54Z","2021-10-30T10:34:56Z","2021-11-01T19:27:29Z","2021-11-03T22:13:19Z","2021-11-04T15:30:51Z","2021-11-05T21:03:11Z","2021-11-06T13:12:01Z","2021-11-07T04:05:46Z","2021-11-09T04:50:14Z","2021-11-09T22:58:47Z","2021-11-09T23:41:10Z","2021-11-10T03:21:38Z","2021-11-10T09:49:06Z","2021-11-10T12:40:41Z","2021-11-10T13:08:49Z","2021-11-10T19:31:10Z","2021-11-12T22:11:09Z","2021-11-13T08:29:02Z","2021-11-14T00:20:01Z","2021-11-14T17:59:53Z","2021-11-15T00:43:08Z","2021-11-16T08:07:25Z","2021-11-16T18:20:56Z","2021-11-16T19:34:50Z","2021-11-17T03:22:33Z","2021-11-17T11:45:14Z","2021-11-19T18:28:21Z","2021-11-20T04:42:20Z","2021-11-21T05:16:22Z","2021-11-21T19:15:02Z","2021-11-22T00:53:30Z","2021-11-23T06:47:05Z","2021-11-23T20:03:01Z","2021-11-25T20:24:13Z","2021-11-26T07:57:08Z","2021-11-26T16:08:58Z","2021-11-26T21:50:02Z","2021-11-28T15:42:39Z","2021-11-30T06:59:58Z","2021-11-30T19:27:07Z","2021-12-02T06:32:37Z","2021-12-02T12:23:47Z","2021-12-02T16:50:35Z","2021-12-03T04:10:31Z","2021-12-03T07:05:48Z","2021-12-03T10:55:29Z","2021-12-03T22:13:30Z","2021-12-04T07:31:56Z","2021-12-04T21:29:49Z","2021-12-05T12:36:02Z","2021-12-05T13:07:44Z","2021-12-05T13:43:14Z","2021-12-06T03:47:19Z","2021-12-06T09:28:35Z","2021-12-06T12:59:16Z","2021-12-07T01:34:57Z","2021-12-07T14:03:59Z","2021-12-07T23:12:29Z","2021-12-08T06:40:45Z","2021-12-08T08:17:36Z","2021-12-08T20:39:35Z","2021-12-09T16:39:47Z","2021-12-11T09:59:01Z","2021-12-11T13:59:44Z","2021-12-12T16:12:49Z","2021-12-13T06:31:53Z","2021-12-13T22:18:47Z","2021-12-13T23:33:24Z","2021-12-14T13:39:52Z","2021-12-14T15:05:47Z","2021-12-15T14:16:58Z","2021-12-15T14:31:26Z","2021-12-16T08:32:23Z","2021-12-16T23:00:34Z","2021-12-17T12:47:43Z","2021-12-21T00:12:23Z","2021-12-21T11:50:28Z","2021-12-22T03:53:43Z","2021-12-22T21:51:12Z","2021-12-23T17:27:36Z","2021-12-25T04:41:18Z","2021-12-25T10:11:27Z","2021-12-26T14:42:00Z","2021-12-28T06:08:24Z","2021-12-29T04:52:46Z","2021-12-30T11:50:22Z","2021-12-31T09:10:22Z"],
    'b': ['b1', 'b2', 'b3']
}
parallelize = True
chunk_size = 2000

def run(process, udf, dimension = None, context = None):
    # Prepare data
    data = create_dummy_cube(dims, sizes, labels)

    # Run UDF executor
    t1 = time.time() # Start benchmark
    result = execute_udf(process, udf, data, dimension = dimension, context = context, parallelize = parallelize, chunk_size = chunk_size)
    t2 = time.time() # End benchmark

    # Print result and benchmark
    print('  Time elapsed: %s' % (t2 - t1))
    print(result)


print('reduce_dimension bfast')
run('reduce_dimension', './udfs/reduce_bfast.R', dimension = 't')